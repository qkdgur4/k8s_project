doctype html
html
  head
    meta(charset='utf-8')
    title í•œì…ë¡œê·¸
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css')
    link(rel='stylesheet', href='/css/style.css')

  body
    .header.bg-light.mb-0
      .container
        h1
          a(href='/', class='text-dark text-decoration-none') í•œì…ë¡œê·¸ğŸ½
        p.text-muted.mb-0 ì‘ì€ í•œì…ì—ë„ ì´ì•¼ê¸°ê°€ ë‹´ê²¨ìš” ğŸ²

    .container.mb-5
      h3.mb-4.text-primary ê¸€ ì‘ì„±í•˜ê¸°

      //- ğŸŸ¢ 1. <a> íƒœê·¸ë¥¼ <button> íƒœê·¸ë¡œ ë³€ê²½í•˜ê³  IDë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.
      button.btn.btn-outline-primary.mb-3#show-form-btn ìƒˆ ë¦¬ë·° ì‘ì„±í•˜ê¸°

      //- ğŸŸ¢ 2. ë¦¬ë·° ì‘ì„± í¼ì„ ì—¬ê¸°ì— ìˆ¨ê²¨ë‘¡ë‹ˆë‹¤. (style="display: none;")
      #review-form-wrapper(style="display: none;")
        //- action ì£¼ì†Œë¥¼ ì˜¬ë°”ë¥¸ API ê²½ë¡œë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.
        form#new-review-form(action='/api/reviews' method='POST')
          .form-group
            label(for='name') ì´ë¦„
            input#name.form-control(type='text' name='name' placeholder='ìµëª…ë„ ê°€ëŠ¥í•´ìš”')

          .form-group
            label(for='store') ê°€ê²Œëª…
            input#store.form-control(type='text' name='store' placeholder='ë°©ë¬¸í•œ ìŒì‹ì  ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”')

          //- (ì¤‘ëµ) ë‚˜ë¨¸ì§€ í¼ í•„ë“œë“¤ì€ new-review.pugì™€ ë™ì¼í•©ë‹ˆë‹¤.
          .form-group
            label(for='category') ìŒì‹ ë¶„ë¥˜
            select#category.form-control(name='category')
              option(value='í•œì‹') í•œì‹
              option(value='ì¤‘ì‹') ì¤‘ì‹
              option(value='ì¼ì‹') ì¼ì‹
              option(value='ì–‘ì‹') ì–‘ì‹
              option(value='ë¶„ì‹') ë¶„ì‹
              option(value='ê¸°íƒ€') ê¸°íƒ€

          .form-group
            label(for='menu') ë¨¹ì€ ìŒì‹
            input#menu.form-control(type='text' name='menu' placeholder='ì˜ˆ: ê¹€ì¹˜ì°Œê°œ, í¬ë¦¼íŒŒìŠ¤íƒ€ ë“±')

          .form-group
            label(for='taste') ë§› í‰ì 
            select#taste.form-control(name='taste')
              option(value='5') â˜…â˜…â˜…â˜…â˜…
              option(value='4') â˜…â˜…â˜…â˜…â˜†
              option(value='3') â˜…â˜…â˜…â˜†â˜†
              option(value='2') â˜…â˜…â˜†â˜†â˜†
              option(value='1') â˜…â˜†â˜†â˜†â˜†

          .form-group
            label(for='mood') ë¶„ìœ„ê¸°
            input#mood.form-control(type='text' name='mood' placeholder='ì¡°ìš©í•¨, í™œê¸°ì°¸, ê°€ì¡±ì , íŠ¸ë Œë”” ë“±')

          .form-group
            label(for='memo') ì¶”ê°€ ë©”ëª¨
            textarea#memo.form-control(name='memo' rows='4' placeholder='ìœ„ìƒ ìƒíƒœ, ìœ„ì¹˜, ê±¸ë¦¬ëŠ” ì‹œê°„ ë“±ì„ ì ì–´ì£¼ì„¸ìš”')

          .form-group
            label(for='recommend') ì¶”ì²œ ì—¬ë¶€
            select#recommend.form-control(name='recommend')
              option(value='yes') ì¶”ì²œí•´ìš” ğŸ‘
              option(value='no') ì•„ì‰¬ì›Œìš” ğŸ‘

          button.btn.btn-success.btn-block(type='submit') ì‘ì„± ì™„ë£Œ
          button.btn.btn-secondary.btn-block(type='button')#hide-form-btn ì·¨ì†Œ

    .container-fluid.posts.mt-5
      //- (ì¤‘ëµ) ê¸€ ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” ë¶€ë¶„ì€ ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.
      include list.pug

    //- ğŸŸ¢ 3. ìë°”ìŠ¤í¬ë¦½íŠ¸ ë§ˆë²• ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
    script.
      // "ìƒˆ ë¦¬ë·° ì‘ì„±í•˜ê¸°" ë²„íŠ¼ì„ ì°¾ìŠµë‹ˆë‹¤.
      const showButton = document.getElementById('show-form-btn');
      // "ì·¨ì†Œ" ë²„íŠ¼ì„ ì°¾ìŠµë‹ˆë‹¤.
      const hideButton = document.getElementById('hide-form-btn');
      // ìˆ¨ê²¨ì§„ í¼ì´ ë‹´ê¸´ ì˜ì—­ì„ ì°¾ìŠµë‹ˆë‹¤.
      const formWrapper = document.getElementById('review-form-wrapper');
      // í¼ ìì²´ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
      const reviewForm = document.getElementById('new-review-form');

      // "ìƒˆ ë¦¬ë·° ì‘ì„±í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´,
      showButton.addEventListener('click', () => {
        formWrapper.style.display = 'block'; // í¼ ì˜ì—­ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
        showButton.style.display = 'none'; // "ìƒˆ ë¦¬ë·° ì‘ì„±í•˜ê¸°" ë²„íŠ¼ì€ ìˆ¨ê¹ë‹ˆë‹¤.
      });
      
      // "ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´,
      hideButton.addEventListener('click', () => {
        formWrapper.style.display = 'none'; // í¼ ì˜ì—­ì„ ë‹¤ì‹œ ìˆ¨ê¹ë‹ˆë‹¤.
        showButton.style.display = 'block'; // "ìƒˆ ë¦¬ë·° ì‘ì„±í•˜ê¸°" ë²„íŠ¼ì„ ë‹¤ì‹œ ë³´ì—¬ì¤ë‹ˆë‹¤.
      });

      // í¼ì´ "ì œì¶œ"ë  ë•Œì˜ ì´ë²¤íŠ¸ë¥¼ ê°€ë¡œì±•ë‹ˆë‹¤.
      reviewForm.addEventListener('submit', (event) => {
        // í¼ì˜ ê¸°ë³¸ ë™ì‘(í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨)ì„ ë§‰ìŠµë‹ˆë‹¤. (ê°€ì¥ ì¤‘ìš”!)
        event.preventDefault();

        // í¼ì— ì…ë ¥ëœ ë°ì´í„°ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const formData = new FormData(reviewForm);
        const data = Object.fromEntries(formData.entries());

        // 'fetch'ë¥¼ ì‚¬ìš©í•´ì„œ ë°±ì—”ë“œ APIë¡œ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
        fetch('/api/reviews', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
        .then(response => {
          if (response.ok) {
            alert('ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            // ì„±ê³µí•˜ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì„œ ë°©ê¸ˆ ì“´ ê¸€ì„ ëª©ë¡ì—ì„œ í™•ì¸í•©ë‹ˆë‹¤.
            window.location.reload();
          } else {
            alert('ë¦¬ë·° ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      });