// frontend/views/home.pug (ìµœì¢… ì™„ì„±ë³¸ - ë””ìì¸ ë° UX ê°œì„ )

doctype html
html
  head
    meta(charset='utf-8')
    title í•œì…ë¡œê·¸
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css')
    link(rel='stylesheet', href='/css/style.css')
  body
    //- ğŸŸ¢ 1. í—¤ë”ì— ID ì¶”ê°€ (ìˆ¨ê¸°ê¸°/ë³´ì—¬ì£¼ê¸° ìš©)
    .header.bg-light.mb-0#header-section
      .container
        h1: a(href='/', class='text-dark text-decoration-none') í•œì…ë¡œê·¸ğŸ½
        p.text-muted.mb-0 ì‘ì€ í•œì…ì—ë„ ì´ì•¼ê¸°ê°€ ë‹´ê²¨ìš” ğŸ²

    //- ğŸŸ¢ 2. ìƒˆ ë¦¬ë·° ì‘ì„± í¼ ì„¹ì…˜ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê²¨ì§)
    .container.mb-5#form-section(style="display: none;")
      h3.mb-4.text-primary âœï¸ ìƒˆ ë¦¬ë·° ì‘ì„±
      form#new-review-form
        .form-group
          label(for='name') ì´ë¦„
          input#name.form-control(type='text' name='name' placeholder='ìµëª…ë„ ê°€ëŠ¥í•´ìš”' required)
        .form-group
          label(for='store') ê°€ê²Œëª…
          input#store.form-control(type='text' name='store' placeholder='ë°©ë¬¸í•œ ìŒì‹ì  ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”' required)
        .form-group
          label(for='category') ìŒì‹ ë¶„ë¥˜
          select#category.form-control(name='category' required)
            option(value='') -- ì„ íƒ --
            option(value='í•œì‹') í•œì‹
            option(value='ì¤‘ì‹') ì¤‘ì‹
            option(value='ì¼ì‹') ì¼ì‹
            option(value='ì–‘ì‹') ì–‘ì‹
            option(value='ë¶„ì‹') ë¶„ì‹
            option(value='ê¸°íƒ€') ê¸°íƒ€
        .form-group
          label(for='menu') ë¨¹ì€ ìŒì‹
          input#menu.form-control(type='text' name='menu' placeholder='ì˜ˆ: ê¹€ì¹˜ì°Œê°œ, í¬ë¦¼íŒŒìŠ¤íƒ€ ë“±' required)
        .form-group
          label(for='taste') ë§› í‰ì 
          select#taste.form-control(name='taste' required)
            option(value='') -- ì„ íƒ --
            option(value='5') â˜…â˜…â˜…â˜…â˜…
            option(value='4') â˜…â˜…â˜…â˜…â˜†
            option(value='3') â˜…â˜…â˜…â˜†â˜†
            option(value='2') â˜…â˜…â˜†â˜†â˜†
            option(value='1') â˜…â˜†â˜†â˜†â˜†
        .form-group
          label(for='mood') ë¶„ìœ„ê¸°
          input#mood.form-control(type='text' name='mood' placeholder='ì¡°ìš©í•¨, í™œê¸°ì°¸, ê°€ì¡±ì , íŠ¸ë Œë”” ë“±' required)
        .form-group
          label(for='memo') ì¶”ê°€ ë©”ëª¨
          textarea#memo.form-control(name='memo' rows='4' placeholder='ìœ„ìƒ ìƒíƒœ, ìœ„ì¹˜, ê±¸ë¦¬ëŠ” ì‹œê°„ ë“±ì„ ì ì–´ì£¼ì„¸ìš”')
        .form-group
          label(for='recommend') ì¶”ì²œ ì—¬ë¶€
          select#recommend.form-control(name='recommend' required)
            option(value='') -- ì„ íƒ --
            option(value='yes') ì¶”ì²œí•´ìš” ğŸ‘
            option(value='no') ì•„ì‰¬ì›Œìš” ğŸ‘
        button.btn.btn-success.btn-block(type='submit') ì‘ì„± ì™„ë£Œ
        button.btn.btn-secondary.btn-block(type='button')#hide-form-btn ì·¨ì†Œ

    //- ğŸŸ¢ 3. ë©”ì¸ ì½˜í…ì¸  (ì¹´í…Œê³ ë¦¬ í•„í„° + ê¸€ ëª©ë¡)
    #page-content
      .container.mb-5
        //- ğŸŸ¢ 4. ë””ìì¸ ìˆ˜ì • (ë²„íŠ¼ì„ ì‘ê²Œ ë§Œë“¤ê³  ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™)
        .d-flex.justify-content-between.align-items-center.mb-4
          //- ì¹´í…Œê³ ë¦¬ í•„í„°
          div
            - const categories = ['ì „ì²´', 'í•œì‹', 'ì¤‘ì‹', 'ì¼ì‹', 'ì–‘ì‹', 'ë¶„ì‹', 'ê¸°íƒ€']
            each cat in categories
              a(href=`/?category=${cat}`, class=`btn ${currentCategory === cat ? 'btn-primary' : 'btn-outline-secondary'} mr-2 mb-2`)= cat
          //- ìƒˆ ë¦¬ë·° ì‘ì„± ë²„íŠ¼
          div
            button.btn.btn-primary.btn-sm#show-form-btn âœï¸ ìƒˆ ë¦¬ë·° ì‘ì„±

      .container-fluid.posts.mt-5
        include list.pug

    //- ğŸŸ¢ 5. ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ ëŒ€í­ ìˆ˜ì •
    script.
      document.addEventListener('DOMContentLoaded', () => {
        // ëª¨ë“  ì„¹ì…˜ê³¼ ë²„íŠ¼ì„ ì„ íƒí•©ë‹ˆë‹¤.
        const header = document.getElementById('header-section');
        const pageContent = document.getElementById('page-content');
        const formSection = document.getElementById('form-section');
        const showButton = document.getElementById('show-form-btn');
        const hideButton = document.getElementById('hide-form-btn');

        // í¼ì„ ë³´ì—¬ì¤„ì§€ ë§ì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
        function toggleSections(showForm) {
          if (showForm) {
            // í¼ì„ ë³´ì—¬ì£¼ê³ , í—¤ë”ì™€ ë©”ì¸ ì½˜í…ì¸ (ëª©ë¡)ëŠ” ìˆ¨ê¹ë‹ˆë‹¤.
            formSection.style.display = 'block';
            header.style.display = 'none';
            pageContent.style.display = 'none';
          } else {
            // í¼ì„ ìˆ¨ê¸°ê³ , í—¤ë”ì™€ ë©”ì¸ ì½˜í…ì¸ (ëª©ë¡)ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
            formSection.style.display = 'none';
            header.style.display = 'block';
            pageContent.style.display = 'block';
          }
        }

        // URLì„ ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
        function updateVisibility() {
          if (window.location.pathname === '/reviews/new') {
            toggleSections(true); // /reviews/new ì£¼ì†Œë©´ í¼ì„ ë³´ì—¬ì¤Œ
          } else {
            toggleSections(false); // ê·¸ ì™¸ ëª¨ë“  ì£¼ì†Œ(/)ëŠ” ëª©ë¡ì„ ë³´ì—¬ì¤Œ
          }
        }

        // "ìƒˆ ë¦¬ë·° ì‘ì„±" ë²„íŠ¼ í´ë¦­ ì‹œ
        showButton.addEventListener('click', () => {
          history.pushState(null, '', '/reviews/new'); // URLì„ /reviews/newë¡œ ë³€ê²½
          updateVisibility(); // í¼ ë³´ì—¬ì£¼ê¸°
        });

        // "ì·¨ì†Œ" ë²„íŠ¼ í´ë¦­ ì‹œ
        hideButton.addEventListener('click', () => {
          history.pushState(null, '', '/'); // URLì„ / ë¡œ ë³€ê²½
          updateVisibility(); // í¼ ìˆ¨ê¸°ê¸°
        });

        // ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
        window.addEventListener('popstate', updateVisibility);
        
        // í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë“œë  ë•Œ
        updateVisibility();
      });

    script(src='/main.js')