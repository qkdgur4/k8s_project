// frontend/views/home.pug (최종 완성본 - Validation 추가)

doctype html
html
  head
    meta(charset='utf-8')
    title 한입로그
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css')
    link(rel='stylesheet', href='/css/style.css')
  body
    .header.bg-light.mb-0
      .container
        h1: a(href='/', class='text-dark text-decoration-none') 한입로그🍽
        p.text-muted.mb-0 작은 한입에도 이야기가 담겨요 🍲
    .container.mb-5
      h3.mb-4.text-primary 글 작성하기
      button.btn.btn-outline-primary.mb-3#show-form-btn 새 리뷰 작성하기
      #review-form-wrapper(style="display: none;")
        form#new-review-form
          .form-group
            label(for='name') 이름
            //- 🟢 'required' 속성 추가
            input#name.form-control(type='text' name='name' placeholder='익명도 가능해요' required)
          .form-group
            label(for='store') 가게명
            //- 🟢 'required' 속성 추가
            input#store.form-control(type='text' name='store' placeholder='방문한 음식점 이름을 적어주세요' required)
          .form-group
            label(for='category') 음식 분류
            //- 🟢 'required' 속성 추가
            select#category.form-control(name='category' required)
              option(value='') -- 선택 --
              option(value='한식') 한식
              option(value='중식') 중식
              option(value='일식') 일식
              option(value='양식') 양식
              option(value='분식') 분식
              option(value='기타') 기타
          .form-group
            label(for='menu') 먹은 음식
            //- 🟢 'required' 속성 추가
            input#menu.form-control(type='text' name='menu' placeholder='예: 김치찌개, 크림파스타 등' required)
          .form-group
            label(for='taste') 맛 평점
            //- 🟢 'required' 속성 추가
            select#taste.form-control(name='taste' required)
              option(value='') -- 선택 --
              option(value='5') ★★★★★
              option(value='4') ★★★★☆
              option(value='3') ★★★☆☆
              option(value='2') ★★☆☆☆
              option(value='1') ★☆☆☆☆
          .form-group
            label(for='mood') 분위기
            //- 🟢 'required' 속성 추가
            input#mood.form-control(type='text' name='mood' placeholder='조용함, 활기참, 가족적, 트렌디 등' required)
          .form-group
            label(for='memo') 추가 메모
            //- 메모는 선택 사항이므로 'required'를 추가하지 않습니다.
            textarea#memo.form-control(name='memo' rows='4' placeholder='위생 상태, 위치, 걸리는 시간 등을 적어주세요')
          .form-group
            label(for='recommend') 추천 여부
            //- 🟢 'required' 속성 추가
            select#recommend.form-control(name='recommend' required)
              option(value='') -- 선택 --
              option(value='yes') 추천해요 👍
              option(value='no') 아쉬워요 👎
          button.btn.btn-success.btn-block(type='submit') 작성 완료
          button.btn.btn-secondary.btn-block(type='button')#hide-form-btn 취소
    .container-fluid.posts.mt-5
      .mb-4.text-center
        - const categories = ['전체', '한식', '중식', '일식', '양식', '분식', '기타']
        each cat in categories
          a(href=`/?category=${cat}`, class=`btn ${currentCategory === cat ? 'btn-primary' : 'btn-outline-secondary'} mr-2 mb-2`)= cat
      include list.pug
  
  //- (페이지 하단 스크립트 부분은 이전과 동일)
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const showButton = document.getElementById('show-form-btn');
      const hideButton = document.getElementById('hide-form-btn');
      const formWrapper = document.getElementById('review-form-wrapper');
      
      function updateFormVisibility() {
        if (window.location.pathname === '/reviews/new') {
          formWrapper.style.display = 'block';
          showButton.style.display = 'none';
        } else {
          formWrapper.style.display = 'none';
          showButton.style.display = 'block';
        }
      }

      showButton.addEventListener('click', () => {
        history.pushState(null, '', '/reviews/new');
        updateFormVisibility();
      });

      hideButton.addEventListener('click', () => {
        history.pushState(null, '', '/');
        updateFormVisibility();
      });

      window.addEventListener('popstate', () => {
        updateFormVisibility();
      });

      updateFormVisibility();
    });
  script(src='/main.js')