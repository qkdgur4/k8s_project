// frontend/views/list.pug (최종 완성본 - URL 인코딩 추가)

if reviews && reviews.length > 0
  h3.my-4.text-primary 작성된 글 목록
  .row
    for review in reviews
      .col-12.mb-4
        .card.shadow-sm.border-0.rounded
          .card-body.p-4
            .d-flex.justify-content-between.align-items-center.mb-2
              div
                h5.card-title.font-weight-bold.mb-0 #{review.store}
                small.text-muted (#{review.name})
              div.text-right
                - const rating = parseInt(review.taste) || 0
                span.h5.text-warning.mb-0 #{'★'.repeat(rating)}#{'☆'.repeat(5 - rating)}
                br
                small.text-muted 맛 평점

            h6.card-subtitle.mb-3.text-muted #{review.category} / #{review.menu}

            p.card-text.mb-3
              strong 태그:
              if Array.isArray(review.tags) && review.tags.length > 0
                each tag in review.tags
                  a.badge.badge-info.mr-1.mb-1(href=`/?tag=${tag}`)= tag
              else
                span.text-muted.ml-2 -

            p.card-text.mb-3
              strong 추천:
              if review.recommend === 'yes'
                span.badge.badge-success.ml-2 추천해요 👍
              else
                span.badge.badge-secondary.ml-2 아쉬워요 👎

            .d-flex.justify-content-between.align-items-end.border-top.pt-3.mt-3
              small.text-muted.review-memo #{review.memo || '메모 없음'}
              small.text-muted.review-date #{new Date(review.createdAt).toLocaleDateString()}
            
            .text-right.mt-2
              //- 🟢🟢🟢 바로 여기가 수정된 부분입니다! 🟢🟢🟢
              //- 1. encodeURIComponent() 함수로 review.store를 감쌌습니다.
              //-    (review.store가 비어있을 경우를 대비해 || '' 안전장치 추가)
              a.btn.btn-sm.btn-outline-info.mr-2(
                href=`https://search.naver.com/search.naver?query=${encodeURIComponent(review.store || '')}`,
                target='_blank',
                rel='noopener'
              ) 🗺️ 자세히 보기
              
              //- 2. 기존 수정/삭제 버튼
              a.btn.btn-sm.btn-outline-secondary(
                href=`/reviews/${review._id}/edit`,
                target='_blank',
                rel='noopener'
              ) ✏ 수정하기
              button.btn.btn-sm.btn-danger.ml-2(
                type='button',
                onclick=`deleteReview('${review._id}')`
              ) 🗑 삭제
else
  .alert.alert-info(role='alert')
    | 아직 작성된 리뷰가 없습니다. 첫 번째 리뷰를 남겨주세요!